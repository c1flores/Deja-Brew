{"ast":null,"code":"import _objectSpread from\"C:/Users/Christian Flores/Desktop/UCB-VIRT-FSF-PT-07-2022-U-LOLC/22-State/02-Challenge/Main/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/Christian Flores/Desktop/UCB-VIRT-FSF-PT-07-2022-U-LOLC/22-State/02-Challenge/Main/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{Link,useParams}from'react-router-dom';import{useQuery}from'@apollo/client';import{useDispatch,useSelector}from'react-redux';import Cart from'../components/Cart';import{REMOVE_FROM_CART,UPDATE_CART_QUANTITY,ADD_TO_CART,UPDATE_PRODUCTS}from'../utils/actions';import{QUERY_PRODUCTS}from'../utils/queries';import{idbPromise}from'../utils/helpers';import spinner from'../assets/spinner.gif';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Detail(){var dispatch=useDispatch();var state=useSelector(function(state){return state;});var _useParams=useParams(),id=_useParams.id;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),currentProduct=_useState2[0],setCurrentProduct=_useState2[1];var _useQuery=useQuery(QUERY_PRODUCTS),loading=_useQuery.loading,data=_useQuery.data;var products=state.products,cart=state.cart;useEffect(function(){// already in global store\nif(products.length){setCurrentProduct(products.find(function(product){return product._id===id;}));}// retrieved from server\nelse if(data){dispatch({type:UPDATE_PRODUCTS,products:data.products});data.products.forEach(function(product){idbPromise('products','put',product);});}// get cache from idb\nelse if(!loading){idbPromise('products','get').then(function(indexedProducts){dispatch({type:UPDATE_PRODUCTS,products:indexedProducts});});}},[products,data,loading,dispatch,id]);var addToCart=function addToCart(){var itemInCart=cart.find(function(cartItem){return cartItem._id===id;});if(itemInCart){dispatch({type:UPDATE_CART_QUANTITY,_id:id,purchaseQuantity:parseInt(itemInCart.purchaseQuantity)+1});idbPromise('cart','put',_objectSpread(_objectSpread({},itemInCart),{},{purchaseQuantity:parseInt(itemInCart.purchaseQuantity)+1}));}else{dispatch({type:ADD_TO_CART,product:_objectSpread(_objectSpread({},currentProduct),{},{purchaseQuantity:1})});idbPromise('cart','put',_objectSpread(_objectSpread({},currentProduct),{},{purchaseQuantity:1}));}};var removeFromCart=function removeFromCart(){dispatch({type:REMOVE_FROM_CART,_id:currentProduct._id});idbPromise('cart','delete',_objectSpread({},currentProduct));};return/*#__PURE__*/_jsxs(_Fragment,{children:[currentProduct&&cart?/*#__PURE__*/_jsxs(\"div\",{className:\"container my-1\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u2190 Back to Products\"}),/*#__PURE__*/_jsx(\"h2\",{children:currentProduct.name}),/*#__PURE__*/_jsx(\"p\",{children:currentProduct.description}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price:\"}),\"$\",currentProduct.price,' ',/*#__PURE__*/_jsx(\"button\",{onClick:addToCart,children:\"Add to Cart\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!cart.find(function(p){return p._id===currentProduct._id;}),onClick:removeFromCart,children:\"Remove from Cart\"})]}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/\".concat(currentProduct.image),alt:currentProduct.name})]}):null,loading?/*#__PURE__*/_jsx(\"img\",{src:spinner,alt:\"loading\"}):null,/*#__PURE__*/_jsx(Cart,{})]});}export default Detail;","map":{"version":3,"names":["React","useEffect","useState","Link","useParams","useQuery","useDispatch","useSelector","Cart","REMOVE_FROM_CART","UPDATE_CART_QUANTITY","ADD_TO_CART","UPDATE_PRODUCTS","QUERY_PRODUCTS","idbPromise","spinner","Detail","dispatch","state","id","currentProduct","setCurrentProduct","loading","data","products","cart","length","find","product","_id","type","forEach","then","indexedProducts","addToCart","itemInCart","cartItem","purchaseQuantity","parseInt","removeFromCart","name","description","price","p","image"],"sources":["C:/Users/Christian Flores/Desktop/UCB-VIRT-FSF-PT-07-2022-U-LOLC/22-State/02-Challenge/Main/client/src/pages/Detail.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Link, useParams } from 'react-router-dom';\r\nimport { useQuery } from '@apollo/client';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\nimport Cart from '../components/Cart';\r\nimport {\r\n  REMOVE_FROM_CART,\r\n  UPDATE_CART_QUANTITY,\r\n  ADD_TO_CART,\r\n  UPDATE_PRODUCTS,\r\n} from '../utils/actions';\r\nimport { QUERY_PRODUCTS } from '../utils/queries';\r\nimport { idbPromise } from '../utils/helpers';\r\nimport spinner from '../assets/spinner.gif';\r\n\r\nfunction Detail() {\r\n  const dispatch = useDispatch();\r\n  const state = useSelector((state) => state);\r\n  const { id } = useParams();\r\n\r\n  const [currentProduct, setCurrentProduct] = useState({});\r\n\r\n  const { loading, data } = useQuery(QUERY_PRODUCTS);\r\n\r\n  const { products, cart } = state;\r\n\r\n  useEffect(() => {\r\n    // already in global store\r\n    if (products.length) {\r\n      setCurrentProduct(products.find((product) => product._id === id));\r\n    }\r\n    // retrieved from server\r\n    else if (data) {\r\n      dispatch({\r\n        type: UPDATE_PRODUCTS,\r\n        products: data.products,\r\n      });\r\n\r\n      data.products.forEach((product) => {\r\n        idbPromise('products', 'put', product);\r\n      });\r\n    }\r\n    // get cache from idb\r\n    else if (!loading) {\r\n      idbPromise('products', 'get').then((indexedProducts) => {\r\n        dispatch({\r\n          type: UPDATE_PRODUCTS,\r\n          products: indexedProducts,\r\n        });\r\n      });\r\n    }\r\n  }, [products, data, loading, dispatch, id]);\r\n\r\n  const addToCart = () => {\r\n    const itemInCart = cart.find((cartItem) => cartItem._id === id);\r\n    if (itemInCart) {\r\n      dispatch({\r\n        type: UPDATE_CART_QUANTITY,\r\n        _id: id,\r\n        purchaseQuantity: parseInt(itemInCart.purchaseQuantity) + 1,\r\n      });\r\n      idbPromise('cart', 'put', {\r\n        ...itemInCart,\r\n        purchaseQuantity: parseInt(itemInCart.purchaseQuantity) + 1,\r\n      });\r\n    } else {\r\n      dispatch({\r\n        type: ADD_TO_CART,\r\n        product: { ...currentProduct, purchaseQuantity: 1 },\r\n      });\r\n      idbPromise('cart', 'put', { ...currentProduct, purchaseQuantity: 1 });\r\n    }\r\n  };\r\n\r\n  const removeFromCart = () => {\r\n    dispatch({\r\n      type: REMOVE_FROM_CART,\r\n      _id: currentProduct._id,\r\n    });\r\n\r\n    idbPromise('cart', 'delete', { ...currentProduct });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {currentProduct && cart ? (\r\n        <div className=\"container my-1\">\r\n          <Link to=\"/\">‚Üê Back to Products</Link>\r\n\r\n          <h2>{currentProduct.name}</h2>\r\n\r\n          <p>{currentProduct.description}</p>\r\n\r\n          <p>\r\n            <strong>Price:</strong>${currentProduct.price}{' '}\r\n            <button onClick={addToCart}>Add to Cart</button>\r\n            <button\r\n              disabled={!cart.find((p) => p._id === currentProduct._id)}\r\n              onClick={removeFromCart}\r\n            >\r\n              Remove from Cart\r\n            </button>\r\n          </p>\r\n\r\n          <img\r\n            src={`/images/${currentProduct.image}`}\r\n            alt={currentProduct.name}\r\n          />\r\n        </div>\r\n      ) : null}\r\n      {loading ? <img src={spinner} alt=\"loading\" /> : null}\r\n      <Cart />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Detail;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}